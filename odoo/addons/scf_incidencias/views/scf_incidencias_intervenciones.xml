<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="scf_incidencias.intervenciones_search" model="ir.ui.view">
            <field name="name">scf.incidencias.intervenciones.search</field>
            <field name="model">scf_incidencias.intervenciones</field>
            <field name="arch" type="xml">
                <search string="Buscar Partes de Trabajo">

                    <field name="name" />
                    <field name="issue_id" />
                    <field name="user_id" />
                    <field name="date" />


                    <filter string="Mis Intervenciones" name="my_work"
                        domain="[('user_id', '=', uid)]" />

                    <separator />


                    <filter string="Hoy" name="today"
                        domain="[('date', '&gt;=', context_today().strftime('%Y-%m-%d 00:00:00')), 
                                 ('date', '&lt;=', context_today().strftime('%Y-%m-%d 23:59:59'))]" />

                    <group expand="1" string="Agrupar Por">
                        <filter string="Técnico" name="group_user"
                            context="{'group_by':'user_id'}" />
                        <filter string="Incidencia" name="group_issue"
                            context="{'group_by':'issue_id'}" />

                        <filter string="Mes" name="group_date"
                            context="{'group_by':'date:month'}" />
                    </group>
                </search>
            </field>
        </record>

        <record id="scf_incidencias.intervenciones_tree" model="ir.ui.view">
            <field name="name">scf.incidencias.intervenciones.tree</field>
            <field name="model">scf_incidencias.intervenciones</field>
            <field name="arch" type="xml">
                <tree string="Partes de Trabajo"
                    sample="1"
                    decoration-muted="time_spent == 0"
                    default_order="date desc">


                    <field name="date" widget="date" />


                    <field name="user_id" widget="many2one_avatar_user"
                        options="{'display_avatar': True}" />

                    <field name="issue_id" decoration-bf="1" />
                    <field name="name" optional="show" />


                    <field name="time_spent"
                        widget="float_time"
                        sum="Total Horas"
                        decoration-bf="1"
                        class="text-end" />
                </tree>
            </field>
        </record>

        <record id="scf_incidencias.intervenciones_form" model="ir.ui.view">
            <field name="name">scf.incidencias.intervenciones.form</field>
            <field name="model">scf_incidencias.intervenciones</field>
            <field name="arch" type="xml">
                <form string="Parte de Trabajo">
                    <sheet>


                        <field name="user_id" widget="many2one_avatar_user" class="oe_avatar" />

                        <div class="oe_title">
                            <label for="name" class="oe_edit_only" string="Resumen del trabajo" />
                            <h1>
                                <field name="name" placeholder="Ej: Cambio de disco duro..." />
                            </h1>
                        </div>

                        <group>
                            <group string="Contexto">

                                <field name="issue_id" options="{'no_create': True}" />
                                <field name="date" />
                            </group>
                            <group string="Imputación">

                                <field name="time_spent" widget="float_time"
                                    style="font-size: 1.5em; font-weight: bold;" />
                            </group>
                        </group>

                        <notebook>
                            <page string="Detalles Técnicos">

                                <field name="description" widget="html"
                                    placeholder="Pasos técnicos..." />
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="scf_incidencias.intervenciones_graph" model="ir.ui.view">
            <field name="name">scf.incidencias.intervenciones.graph</field>
            <field name="model">scf_incidencias.intervenciones</field>
            <field name="arch" type="xml">
                <graph string="Análisis de Horas" type="bar" stacked="True">
                    <field name="user_id" />
                    <field name="time_spent" type="measure" />
                </graph>
            </field>
        </record>

        <record id="scf_incidencias.intervenciones_pivot" model="ir.ui.view">
            <field name="name">scf.incidencias.intervenciones.pivot</field>
            <field name="model">scf_incidencias.intervenciones</field>
            <field name="arch" type="xml">
                <pivot string="Análisis de Horas" display_quantity="true">
                    <field name="user_id" type="row"/>
                    <field name="date" interval="month" type="col"/>
                    <field name="time_spent" type="measure"/>
                </pivot>
            </field>
        </record>

    </data>
</odoo>